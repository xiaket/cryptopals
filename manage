#!/bin/bash

set -o errexit
set -o nounset
set -o pipefail


# define tasks here
get_current_job (){
  cat solutions/registry.go | grep Prob | tail -n 1 | sed "s/://g;s/\"//g" | awk '{print $1}'
}

run () {
  current=$(get_current_job)
  test_ > /dev/null && go run Manager.go $current
}

build () {
  test_
  go build -o registry cmd/registry/main.go
}

test_ () {
  go test ./pkg/lib
  go test ./pkg/set1
  #go test ./pkg/set2
}

list () {
  grep "() {" $0 | grep -v 'grep ' | awk '{print $1}' | sort
}

# main start here
command=${1:-""}

if [ -n "$(type -t $command)" ] && [ "$(type -t $command)" = function ]
then
  eval $command
  exit $?
fi

case "$command" in
  ls)
    list;;
  test)
    test_;;
  *)
    run
esac
