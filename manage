#!/bin/bash

set -o errexit
set -o nounset
set -o pipefail


# define tasks here
get_current_job (){
  cat solutions/registry.go | grep Prob | tail -n 1 | sed "s/://g" | awk '{print $1}'
}

run () {
  current=$(get_current_job)
  go run Manager.go $current
}

test_ () {
  go test ./lib ./solutions
}

less_ () {
  current=$(get_current_job)
  doc_name=`echo "$current" | sed "s/.go/.md/g;s/\.\//^/g;s/\//\/README./g;s/\^/\.\//g"`
  less $doc_name
}

list () {
  grep "() {" $0 | grep -v 'grep ' | awk '{print $1}' | sort
}

# main start here
command=${1:-""}

if [ -n "$(type -t $command)" ] && [ "$(type -t $command)" = function ]
then
  eval $command
  exit $?
fi

case "$command" in
  l)
    less_;;
  ls)
    list;;
  test)
    test_;;
  *)
    run
esac
